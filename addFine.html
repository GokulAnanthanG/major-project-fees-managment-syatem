<!-- MAJOR PROJECT FESS MANAGEMENT SYSTEM -->
<!-- TEAM -->
<!--
    ****************
    G.GOKUL ANANTHAN
    N.PREM
    N.SATHISH KUMAR
    S.SUDHAKAR
    ****************
UNDER THE GUIDANCE OF
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
MR.Ashok Lingam Sir & MR.Karuppasamy sir
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--font awesome cdn-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
   
    <!--chart-->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
      integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!--bootsrap-->
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
      <!--alert library-->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
 <!--css-->
 <link rel="stylesheet" href="./assets/css/addFine.css" />
 <link
   rel="shortcut icon"
   href="assets/images/favicon.ico"
   type="image/x-icon"
 />
    <title>SSB FESS MANAGEMENT SYSTEM | ADMIN Add Fees</title>
  </head>
  <body> 
    <!-- The sidebar -->
    <div class="sidebar">
        <div class="logo">
            <center>
              <img class="img-responsive" src="./assets/images/logo.png" alt="" />
              <p>SSB</p>
            </center>
          </div>
          <p class="menu-text">Menu</p>
        
        <a  href="dashboard.html">
            <i class="fa fa-home"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Home</span>
          </a>
          <a class="active" href="addPayment.html" title="add fees payments">
            <i class="fa fa-add"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Fees</span>
          </a>
          <a href="recent.html" title="recent payments">
            <i class="fa fa-history"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Recent</span
            >
          </a>
          <a href="search.html" title="search individual report">
            <i class="fa fa-search"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Search</span
            >
          </a>
          <a href="report.html" title="view payment report and generate report for department">
            <i class="fa fa-clipboard-list"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Report</span
            >
          </a>
        </a>
        <a href="staff.html" title="add staff & view,edit,delete ">
          <i class="fa fa-user-circle"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
            >Staff</span
          >
        </a>
          <a href="student.html" title="add student & view,edit,delete ">
            <i class="fa fa-user"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Student</span
            >
          </a>
          <a href="setting.html" title="add sem fees for department , skill fees and rest pass">
            <i class="fa fa-gear"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Settings</span>
          </a>
          <a href="#" id="logout">
            <i class="fa-solid fa-right-from-bracket" title="logout"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Logout</span>
          </a>
    </div>

    <!-- Page content -->
    <div class="content">
        <div class="row  top">
            <div class="col-lg-6">  <h3 class="title"><i class="fa fa-add"></i> Fine</h3></div>
            <div class="col-lg-6 pt-4   ">  
                
            </div>
            <!--row-->
        </div>
<br>
      <div class="container">
         <a href="addPayment.html"><button  title="add  fees" class="top-button "><i class="fa fa-add"></i>&nbsp;Fees</button></a> &nbsp;   <a href="addFine.html"><button class="top-button top-button-active"  title="add fine"><i class="fa fa-add"></i>&nbsp;Fine</button></a> &nbsp;<span class="status"></span> &nbsp;<span class="status2"></span> &nbsp;<span class="status3"></span> &nbsp;<span class="status4"></span>
       <!-- #form-->
 
       <div class="form">
           <form id="frm">
     <input type="number" name="rollNo" id="rollNo"> <input type="number" name="batch" id="batch"> <button title="search" class="search" type="button"><i class="fa fa-search" ></i></button>
    <div class="amount-inputs">
             <br>
<label for="">Name :</label> <b><span id="name">--</span></b>&nbsp;&nbsp;<label for="">Department :</label> <b><span id="department">--</span></b>
<br>
        <label for="">Fine</label>
        <br>
        <input type="number" readonly name="amount" id="amount">
        <br>
        <label for="">Add</label>
        <br>
        <input type="number" name="addFine" id="addFine">

        <button type="button" class="button1" title="add fine"><i class="fa fa-plus"></i></button>
        <br>
        <label for="">Reduce</label>
        <br>
        <input type="number" name="reduceFine" id="reduceFine">
        <button type="button" class="button2" title="reduce fine"><i class="fa fa-minus"></i></button>
        <br><br>
        
        <!--amount inputs-->
   <center><i class="spinner-border"></i></center>
    </div>    
    </div>
      <!-- #end form -->
    </form>
<hr>
<!--footer-->
<p align="center" class="m-1">
    &copy; Sri Sankara Bhagavthi Arts & Science College. All Rights
    Reserved
  </p>
<!--footer-->
                <!--container-->
      </div>
    <!--end content-->
</div>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
 <!--jquery-->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script>$(document).ready(()=>{


try {
  if(JSON.parse(localStorage.getItem("FMSUsEr")).pos!="nimda"){
   window.location.href="index.html";
  }
} catch (error) {
  window.location.href="index.html";
}
$("#logout").click(()=>{

  swal("Are you sure you want to do this?", {
  buttons: ["cancel", true],
}).then((data)=>{
  if(data==true){
    localStorage.removeItem("FMSUsEr");
window.location.href="index.html";

  }

})

})


    try{
    $("#batch").val(JSON.parse(localStorage.getItem("FMSbATcHSeM")).batch);
    }
   catch(err){
    swal("please set the batch & sem", " ", "warning");
   }

   //getStudent
   var studentRecord;
    
function getStudent(){
    $.ajax({
  async:false,
  method:"post",
  url:"./php/getIndivdualStudent.php",
  data:{rollNo:$("#rollNo").val(),batch:$("#batch").val()},
  success:(data)=>{
    if(data!=0||data!=000){
 studentRecord=JSON.parse(data);
 $("#name").html(studentRecord.name)
 $("#department").html(studentRecord.department)

 $(".spinner-border").css("display","none");
     }
    else if(data==0){
        swal("no student record", " ", "warning");
        $(".spinner-border").css("display","none");
    }
    else{
        swal("oops something went wrong :(", " ", "warning");
        $(".spinner-border").css("display","none");
    }
  },
  error:(err)=>{
    swal("oops something went wrong :(", " ", "warning");
    $(".spinner-border").css("display","none");
  console.log(err);
  }
})//ajax
}//fn
$(".search").click(()=>{
  if($("#rollNo").val()!=""&&$("#batch").val()!=""){
    $(".spinner-border").css("display","inline-block");
    studentRecord=undefined;
  
getStudent();

//getFeesRecord
var fineHaveToPay=0;
$.ajax({
  async:false,
  method:"post",
  url:"./php/getOverAllFeesRecordsForIndivdualStudent.php",
  data: {batch:$("#batch").val(),rollNo :$("#rollNo").val()},
  success:(data)=>{
    console.log("--",data);
   if(data!=0||data!=000){
var fetchedData=JSON.parse(data);
let finePayed=0;
fetchedData.forEach(e => {
    finePayed+=Number(e.fine);
});//foreach
 $("#amount").val(Number(studentRecord.fine)-finePayed);
   }
   else if(data==0){
$("#amount").val(studentRecord.fine);
   }
   else{
    swal("oops something went wrong :(", " ", "warning");
   }
  },
  error:(err)=>{
    swal("oops something went wrong :(", " ", "warning");
console.log(err);
  }
})
  }
  else            swal("please enter the roll no and batch", " ", "warning");   
})//search

//add
$(".button1").click(()=>{
    if(studentRecord!=undefined){
          if($("#amount").val()!=""){
 if($("#amount").val()!=""){
    swal("Are you sure you want to do this?", {
  buttons: ["cancel", true],
}).then((data)=>{
  if(data==true){
    $(".spinner-border").css("display","inline-block");
    getStudent();
    $.ajax({
  async:false,
  method:"post",
  url:"./php/updateFine.php",
  data: {batch:$("#batch").val(),rollNo :$("#rollNo").val(),fine:Number(studentRecord.fine)+Number($("#addFine").val())},
  success:(data)=>{
      if(data==1){
        $(".spinner-border").css("display","none");
        swal({
              title: "Fine Updated",
              icon: "success",
              button: "ok",
            });
            $("#frm")[0].reset();
            $("#name").html("")
 $("#department").html("")
            try{
    $("#batch").val(JSON.parse(localStorage.getItem("FMSbATcHSeM")).batch);
    }
   catch(err){
    swal("please set the batch & sem", " ", "warning");
   }
      }
      else{
        $(".spinner-border").css("display","none");
        swal("oops something went wrong :( failed to update", " ", "warning");  
      }
  },error:err=>{
    $(".spinner-border").css("display","none");
      console.log(err);
      swal("oops something went wrong :( failed to update", " ", "warning"); 

  }
    })//ajax
  }
})//promise
   }
   else
   swal("empty op not allowed", " ", "warning"); 

          }
          else{
            swal("empty op is not allowed", " ", "warning");   
          }
    }
    else{
        swal("please search the student record with roll no", " ", "warning"); 
    }
})

$(".button2").click(()=>{
    if(studentRecord!=undefined){
          if($("#amount").val()!=""){
 if($("#amount").val()!=""){
    swal("Are you sure you want to do this?", {
  buttons: ["cancel", true],
}).then((data)=>{
  if(data==true){
    getStudent();
    console.log(studentRecord.fine);
    $(".spinner-border").css("display","inline-block");
      $.ajax({
  async:false,
  method:"post",
  url:"./php/updateFine.php",
  data: {batch:$("#batch").val(),rollNo :$("#rollNo").val(),fine:Number(studentRecord.fine)-Number($("#reduceFine").val())},
  success:(data)=>{
      if(data==1){
        $(".spinner-border").css("display","none");
        swal({
              title: "Fine Updated",
              icon: "success",
              button: "ok",
            });
            $("#frm")[0].reset();
            $("#name").html("")
 $("#department").html("")
            try{
    $("#batch").val(JSON.parse(localStorage.getItem("FMSbATcHSeM")).batch);
    }
   catch(err){
    swal("please set the batch & sem", " ", "warning");
   }
      }
      else{
        $(".spinner-border").css("display","none");
        swal("oops something went wrong :( failed to update", " ", "warning");  
      }
  },error:err=>{
    $(".spinner-border").css("display","none");
      console.log(err);
      swal("oops something went wrong :( failed to update", " ", "warning"); 

  }
    })//ajax
   }
})//promise
          }}
          else{
            swal("empty op is not allowed", " ", "warning");   
          }
    }
    else{
        swal("please search the student record with roll no", " ", "warning"); 
    }
})


 
 })</script>
  </body>
  
 </html>
