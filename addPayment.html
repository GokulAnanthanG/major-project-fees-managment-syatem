<!-- MAJOR PROJECT FESS MANAGEMENT SYSTEM -->
<!-- TEAM -->
<!--
    ****************
    G.GOKUL ANANTHAN
    N.PREM
    N.SATHISH KUMAR
    S.SUDHAKAR
    ****************
UNDER THE GUIDANCE OF
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
MR.Ashok Lingam Sir & MR.Karuppasamy sir
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--font awesome cdn-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
   
    <!--chart-->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
      integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!--bootsrap-->
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
      <!--alert library-->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
 <!--css-->
 <link rel="stylesheet" href="./assets/css/addPayment.css" />
 <link
   rel="shortcut icon"
   href="assets/images/favicon.ico"
   type="image/x-icon"
 />
    <title>SSB FESS MANAGEMENT SYSTEM | ADMIN Add Fees</title>
  </head>
  <body> 
    <!-- The sidebar -->
    <div class="sidebar">
        <div class="logo">
            <center>
              <img class="img-responsive" src="./assets/images/logo.png" alt="" />
              <p>SSB</p>
            </center>
          </div>
          <p class="menu-text">Menu</p>
        
        <a  href="dashboard.html">
            <i class="fa fa-home"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Home</span>
          </a>
          <a class="active" href="addPayment.html" title="add fees payments">
            <i class="fa fa-add"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Fees</span>
          </a>
          <a href="student.html" title="recent payments">
            <i class="fa fa-history"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Recent</span
            >
          </a>
          <a href="student.html" title="search individual report">
            <i class="fa fa-search"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Search</span
            >
          </a>
          <a href="student.html" title="view payment report and generate report for department">
            <i class="fa fa-clipboard-list"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Report</span
            >
          </a>
        </a>
        <a href="staff.html" title="add staff & view,edit,delete ">
          <i class="fa fa-user-circle"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
            >Staff</span
          >
        </a>
          <a href="student.html" title="add student & view,edit,delete ">
            <i class="fa fa-user"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span
              >Student</span
            >
          </a>
          <a href="setting.html" title="add sem fees for department , skill fees and rest pass">
            <i class="fa fa-gear"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Settings</span>
          </a>
          <a href="#">
            <i class="fa-solid fa-right-from-bracket" title="logout"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Logout</span>
          </a>
    </div>

    <!-- Page content -->
    <div class="content">
        <div class="row  top">
            <div class="col-lg-6">  <h3 class="title"><i class="fa fa-add"></i> Fees</h3></div>
            <div class="col-lg-6 pt-4   ">  
                
            </div>
            <!--row-->
        </div>
<br>
      <div class="container">
         <a href="addPayment.html"><button  title="add  fees" class="top-button top-button-active"><i class="fa fa-add"></i>&nbsp;Fees</button></a> &nbsp;   <a href="addFine.html"><button class="top-button"  title="add fine"><i class="fa fa-add"></i>&nbsp;Fine</button></a> &nbsp;<span class="status"></span> &nbsp;<span class="status2"></span> &nbsp;<span class="status3"></span> &nbsp;<span class="status4"></span>
       <!-- #form-->
 
       <div class="form">
        <form id="frm" method="post">
<table>
<tr>
  <td><label for="rollNo">Roll No</label><br>
    <input type="number" name="rollNo" id="rollNo">
    </td>
    <td><label for="batch">Batch</label><br>
      <input   type="number" autocomplete="off" name="batch" id="batch">
      </td>
      <td><label for="sem">Semster</label><br>
        <input   type="number" autocomplete="off" name="sem" id="sem">
        </td>
</tr>
  <tr>
      <td><label for="regNo">Registration No:</label><br>
      <input type="number" name="regNo" id="regNo">
      </td>
      <td><label for="name">Name</label><br>
          <input    type="text" autocomplete="off" name="name" id="name">
          </td>
      
              <td><label for="department">Department</label><br>
                  <input   type="text" autocomplete="off" name="department" id="department">
                  </td>
                 
  </tr>
  

  <tr>
    <td><label for="date">Date</label><br>
    <input type="date" autocomplete="off" name="date" id="date">
    </td>
    
</tr>


  <tr>
      <td><label for="recpNO">Receipt No</label><br>
      <input type="number" autocomplete="off" name="recpNo" id="recpNo">
      </td>
      <td><label class="lastRecpNo" for="lastRecpNo">Last Receipt No</label><br>
          <input   type="number" autocomplete="off" name="lastRecpNo" id="lastRecpNo">
          </td>
  </tr>

  <tr>
      <td><label for="collegeFees">College Fees</label><br>
      <input  value="0" type="number" autocomplete="off" name="collegeFees" id="collegeFees">
      </td>
      <td><label class="heading-red" for="collegeFeesHaveToPay">College Fees Have To Pay</label><br>
          <input  value="0"   type="number" autocomplete="off" name="collegeFeesHaveToPay" id="collegeFeesHaveToPay">
          </td>
          <td colspan="3"><label class="heading-green" for="collegeFeesPayed">College Fees Payed</label><br>
              <input  value="0"    type="number" autocomplete="off" name="collegeFeesPayed" id="collegeFeesPayed">
              </td>
  </tr>
  <tr>
      <td><label for="skillFees">Skill Fees</label><br>
      <input  value="0" type="number" autocomplete="off" name="skillFees" id="skillFees">
      </td>
      <td><label class="heading-red" for="skillFeesHaveToPay">Skill Fees Have To Pay</label><br>
          <input  value="0"   type="number" autocomplete="off" id="skillFeesHaveToPay">
          </td>
          <td colspan="3"><label class="heading-green" for="skillFeesPayed">Skill Fees Payed</label><br>
              <input   value="0"    type="number" autocomplete="off" id="skillFeesPayed">
              </td>
  </tr>
  <tr>
      <td><label for="busOrVanFees">Bus or Van Fees</label><br>
      <input  value="0" type="number" autocomplete="off" name="busOrVanFees" id="busOrVanFees">
      </td>
      <td><label class="heading-red" for="busOrVanFeesHaveToPay">Bus or Van Fees Have To Pay</label><br>
          <input  value="0"   type="number" autocomplete="off" id="busOrVanFeesHaveToPay">
          </td>
          <td colspan="3"><label class="heading-green" for="busOrVanFeesPayed">Bus or Van Fees Payed</label><br>
              <input   value="0"    type="number" autocomplete="off" id="busOrVanFeesPayed">
              </td>
  </tr>
  <tr>
      <td><label for="otherFees">Other Fees</label><br>
      <input  value="0" type="number" autocomplete="off" name="otherFees" id="otherFees">
      </td>
      <td><label class="heading-red" for="otherFeesHaveToPay">Other Fees Have To Pay</label><br>
          <input value="0"   type="number" autocomplete="off" id="otherFeesHaveToPay">
          </td>
          <td colspan="3"><label class="heading-green" for="otherFeesPayed">Other Fees Payed</label><br>
              <input  value="0"    type="number" autocomplete="off" id="otherFeesPayed">
              </td>
  </tr>

  <tr>
    <td><label for="fine">Fine</label><br>
    <input  value="0" type="number" autocomplete="off" name="fine" id="fine">
    </td>
    <td><label class="heading-red" for="fineHaveToPay">Fine Have To Pay</label><br>
        <input value="0"   type="number" autocomplete="off" id="fineHaveToPay">
        </td>
        <td colspan="3"><label class="heading-green" for="finePayed">Fine Payed</label><br>
            <input  value="0"    type="number" autocomplete="off" id="finePayed">
            </td>
</tr>
  
  <tr>
      <td> 
      <center>
        <label for="total">Total</label>
        <h3 id="total">0</h3>
      </center>
      </td>
      <td> 
          <button type="reset" class="button1"><i class="fa fa-rotate-left"></i>&nbsp; reset</button>
          </td>
          <td colspan="3">
              <button type="button" class="button2"><i class="spinner-border"></i><i   class="fa fa-add btnText"></i><span class="btnText">Add</button>
              </td>
  </tr>
  
  
</table>
</form>
      </div>
      <!-- #end form -->
   
<hr>
<!--footer-->
<p align="center" class="m-1">
    &copy; Sri Sankara Bhagavthi Arts & Science College. All Rights
    Reserved
  </p>
<!--footer-->
                <!--container-->
      </div>
    <!--end content-->
</div>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
 <!--jquery-->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script>$(document).ready(()=>{
   $("#batch").val(JSON.parse(localStorage.getItem("FMSbATcHSeM")).batch);
    $("#sem").val(JSON.parse(localStorage.getItem("FMSbATcHSeM")).sem)
   $(".button2").click(()=>{
     var rollNoStatus=false,regNoStatus=false,batchStatus=false,semStatus=false,nameStatus=false,departmentStatus=false,dateStatus=false;
      if($("#rollNo").val()!=""){
        $("#rollNo").css({ "border-color": "black" });
        rollNoStatus=true
      }
      else{
      $("#rollNo").css({ "border-color": "red" });
      rollNoStatus=false
      }//rollNO
      if($("#regNo").val()!=""){
        $("#regNo").css({ "border-color": "black" });
        regNoStatus=true
      }
      else{
      $("#regNo").css({ "border-color": "red" });
      regNoStatus=false
      }//regNo
      if($("#batch").val()!=""){
        $("#batch").css({ "border-color": "black" });
        batchStatus=true
      }
      else{
      $("#batch").css({ "border-color": "red" });
      batchStatus=false
      }//batch
      if($("#sem").val()!=""){
        $("#sem").css({ "border-color": "black" });
        semStatus=true
      }
      else{
      $("#sem").css({ "border-color": "red" });
      semStatus=false
      }//sem
      if($("#name").val()!=""){
        $("#name").css({ "border-color": "black" });
        nameStatus=true
      }
      else{
      $("#name").css({ "border-color": "red" });
      semStatus=false
      }//name
      if($("#department").val()!=""){
        $("#department").css({ "border-color": "black" });
        departmentStatus=true
      }
      else{
      $("#department").css({ "border-color": "red" });
      departmentStatus=false
      }//department
      if($("#date").val()!=""){
        $("#date").css({ "border-color": "black" });
        dateStatus=true
      }
      else{
      $("#date").css({ "border-color": "red" });
      dateStatus=false
      }//department
      //condition
      if(regNoStatus&&rollNoStatus&&batchStatus&semStatus&&departmentStatus&&dateStatus&&nameStatus){
        swal("Are you sure you want to do this?", {
  buttons: ["cancel", true],
}).then((data)=>{
  if(data==true){
    $(".spinner-border").css({ display: "inline-block" });
      $(".btnText").css({ display: "none" });
    $.ajax({
      method:"POST",
      url:"./php/addPayment.php",
      data:$("#frm").serialize(),
      success:(data)=>{
         if(data==1){
          swal({
  title: "payment added",
   icon: "success",
  button: "ok",
});
$("#frm")[0].reset();
$(".status").html("");
$(".status2").html("")
$(".status3").html("")
$(".status4").html("")

$(".spinner-border").css({ display: "none" });
      $(".btnText").css({ display: "inline-block" });
        }
        else{
          swal("oops something went wrong", " ", "warning");
          $(".spinner-border").css({ display: "none" });
      $(".btnText").css({ display: "inline-block" });
        }
      },error:(err)=>{
        console.log(err);
        swal("oops something went wrong", " ", "warning");
        $(".spinner-border").css({ display: "none" });
      $(".btnText").css({ display: "inline-block" });
      }
    })
  }
})    }
      else{
        swal("please fill the required fields", " ", "warning");
      }
   })//btn
//process function
function process(){
  function getStudent( ){
  let status;
  let FetchedData;
$.ajax({
  async:false,
  method:"post",
  url:"./php/getIndivdualStudent.php",
  data:{rollNo:$("#rollNo").val(),batch:$("#batch").val()},
  success:(data)=>{
     FetchedData= data;
    status=true;
  },
  error:(err)=>{
 status=false;
  }
})
if(status==true){
  return  Promise.resolve(FetchedData);
}
else
return Promise.reject("something went wrong")
}//fetch student
 

function getlastReciptNo( ){
  let status;
  let FetchedData;
$.ajax({
  async:false,
  method:"GET",
  url:"./php/getlastReciptNo.php",
   success:(data)=>{
     FetchedData= data;
    status=true;
  },
  error:(err)=>{
 status=false;
  }
})
if(status==true){
  return  Promise.resolve(FetchedData);
}
else
return Promise.reject("something went wrong")
}//fetch student

 
//getbatchfees
function getBatchFees( ){
  let status;
  let FetchedData;
$.ajax({
  async:false,
  method:"post",
  url:"./php/getBatchFeesForbatchAndDep.php",
  data:{department:'BCA',batch:$("#batch").val()},
  success:(data)=>{
     FetchedData= data;
    status=true;
  },
  error:(err)=>{
 status=false;
  }
})
if(status==true){
  return  Promise.resolve(FetchedData);
}
else
return Promise.reject("something went wrong")
}//fetch batchfees

 

//getbatchfees
function getSkillFees( ){
  let status;
  let FetchedData;
$.ajax({
  async:false,
  method:"post",
  url:"./php/getSkillToAddStudent.php",
  data: {batch:$("#batch").val()},
  success:(data)=>{
     FetchedData= data;
    status=true;
  },
  error:(err)=>{
 status=false;
  }
})
if(status==true){
  return  Promise.resolve(FetchedData);
}
else
return Promise.reject("something went wrong")
}//fetch getSkillFees

 


//getFeesRecords
function getFeesRecords(){
  let status;
  let FetchedData;
$.ajax({
  async:false,
  method:"post",
  url:"./php/getFeesRecordsForIndivdualStudent.php",
  data: {batch:$("#batch").val(),sem:$("#sem").val(),rollNo :$("#rollNo").val()},
  success:(data)=>{
     FetchedData= data;
    status=true;
  },
  error:(err)=>{
 status=false;
  }
})
if(status==true){
  return  Promise.resolve(FetchedData);
}
else
return Promise.reject("something went wrong")
}//fetch getSkillFees

//<!-----------calculation------------!>
  async function calc(){
    //fetch student record
try {
  var studentData=await getStudent();
 studentData=JSON.parse(studentData);
if(studentData!=0){
  $(".status").html(" student record found ")
  $(".status").css("color","green");
$("#regNo").val(studentData.regNo);
$("#name").val(studentData.name);
$("#department").val(studentData.department);
}
else if(studentData==0){
  $(".status").html(" no student record ")
  $(".status").css("color","orange")
}
else if(studentData==000){
  $(".status").css("color","red")
  $(".status").html(" failed to get student record ")
}
 } catch (error) {
  $(".status").css("color","red")
  $(".status").html(" oops something went wrong :( ")
 }
    //end fetch student record

    //fetch batch fees
   try {
    var batchfees=await getBatchFees();
     batchfees=JSON.parse(batchfees);
    var semFees=0;
    var otherFees=0;
     if(batchfees!=0){
       semFees=batchfees.semFees;
      if($("#sem").val()==1){
        otherFees=batchfees.otherFeesForSem1;
      }else if($("#sem").val()==2){
        otherFees=batchfees.otherFeesForSem2;
      }
      else if($("#sem").val()==3){
        otherFees=batchfees.otherFeesForSem3;
      }
      else if($("#sem").val()==4){
        otherFees=batchfees.otherFeesForSem4;
      }
      else if($("#sem").val()==5){
        otherFees=batchfees.otherFeesForSem5;
      }
      else if($("#sem").val()==6){
        otherFees=batchfees.otherFeesForSem6;
      }else otherFees=0;
      $(".status2").css("color","green")
  $(".status2").html("batch fees found")
     }
    else if(batchfees==0){
      $(".status2").css("color","orange")
  $(".status2").html("no batch fees added for this batch");
     }
     else if(batchfees==000){
      $(".status2").css("color","red")
  $(".status2").html("oops something went wrong :(");
     }
   } catch (error) {
    $(".status2").css("color","red")
  $(".status2").html("oops something went wrong :(");
   }
    //ends fetch batch fees  
    //fetch skill fees 
try {
  var skillFeesDetail=await getSkillFees();
  skillFeesDetail=JSON.parse(skillFeesDetail);
   var skillFees=0;
if(skillFeesDetail!=0){
  let index;skillFeesDetail.find((e,i)=>{
    if(e.value==studentData.skill){
     index=i;
    }
  })
  skillFees=skillFeesDetail[index+1].value;
      $(".status3").css("color","green")
  $(".status3").html("skills found")
     }
    else if(skillFeesDetail==0){
      $(".status3").css("color","orange")
  $(".status3").html("no skills added for this batch");
     }
     else if(skillFeesDetail==000){
      $(".status3").css("color","red")
  $(".status3").html("oops something went wrong :(");
     }
} catch (error) {
  $(".status3").css("color","red")
  $(".status3").html("oops something went wrong :(");
}
//end fetch skill fees 
 


//fetch paymentHistorys
try {
  var paymentHistorys=await getFeesRecords();
  paymentHistorys=JSON.parse(paymentHistorys);
  var collegeFeesPayed=0,skillFeesPayed=0,busOrVanFeesPayed=0,otherFeesPayed=0,finePayed=0;
if(paymentHistorys!=0){
  paymentHistorys.forEach(e => {
  collegeFeesPayed+=Number(e.collegeFees);
  skillFeesPayed+=Number(e.skillFees);
  busOrVanFeesPayed+=Number(e.busOrVanFees);
  otherFeesPayed+=Number(e.otherFees);
  finePayed+=Number(e.fine);
  });//foreach
      $(".status4").css("color","green")
  $(".status4").html("Payment hsitorys found")
     }
    else if(paymentHistorys==0){
      $(".status4").css("color","orange")
  $(".status4").html("no payment history for this sem");
     }
     else if(paymentHistorys==000){
      $(".status4").css("color","red")
  $(".status4").html("oops something went wrong :(");
     }
} catch (error) {
  $(".status4").css("color","red")
  $(".status4").html("oops something went wrong :(");
}
//end fetch paymentHistorys

//fetch receipt no
var lastReceiptNo=await getlastReciptNo();
lastReceiptNo = JSON.parse(lastReceiptNo)
 $("#lastRecpNo").val(Number(lastReceiptNo));
//end fetch receipt no


//field data calc
//have to pay 
$("#collegeFeesHaveToPay").val(Number(semFees)-Number(collegeFeesPayed));
$("#skillFeesHaveToPay").val(Number(skillFees)-Number(skillFeesPayed));
$("#busOrVanFeesHaveToPay").val(Number(studentData.vanOrBusFees*6)-Number(busOrVanFeesPayed));
$("#otherFeesHaveToPay").val(Number(otherFees)-Number(otherFeesPayed));
$("#finePayed").val(Number(studentData.fine)-Number(finePayed));
//payed
$("#collegeFeesPayed").val(collegeFeesPayed);
$("#skillFeesPayed").val(skillFeesPayed);
$("#busOrVanFeesPayed").val(busOrVanFeesPayed);
$("#otherFeesPayed").val(otherFeesPayed);
$("#finePayed").val(finePayed);

//end field data calc

}//fn end
  calc();
//<!-----------End calculation--------!>
}
//process function
   //roll no keyup
   $("#rollNo").keyup(()=>{
     if($("#batch").val()!=""&&$("#sem").val()!=""){
      $(".status").html(" ");
//if block
process();
//end if block
    }
    else{
      $(".status").html("please enter roll no ,batch and sem");
$(".status").css("color","orange");
    }
   })//roll no key up

    //batch keyup
    $("#batch").keyup(()=>{
     if($("#rollNo").val()!=""&&$("#sem").val()!=""){
      $(".status").html(" ");
//if block
process();
//end if block
    }
    else{
      $(".status").html("please enter roll no ,batch and sem");
$(".status").css("color","orange");
    }
   })//batch   key up


   //sem keyup
   $("#sem").keyup(()=>{
     if($("#rollNo").val()!=""&&$("#batch").val()!=""){
      $(".status").html(" ");
//if block
process();
//end if block
    }
    else{
$(".status").html("please enter roll no ,batch and sem");
$(".status").css("color","orange");
    }
   })//sem   key up
   
//cal total
 $("#collegeFees").keyup(()=>{
  let total=Number($("#collegeFees").val())+Number($("#skillFees").val())+Number($("#busOrVanFees").val())+Number($("#otherFees").val())+Number($("#fine").val());
$("#total").html(total)
})

$("#skillFees").keyup(()=>{
  let total=Number($("#collegeFees").val())+Number($("#skillFees").val())+Number($("#busOrVanFees").val())+Number($("#otherFees").val())+Number($("#fine").val());
$("#total").html(total)
})

$("#busOrVanFees").keyup(()=>{
  let total=Number($("#collegeFees").val())+Number($("#skillFees").val())+Number($("#busOrVanFees").val())+Number($("#otherFees").val())+Number($("#fine").val());
$("#total").html(total)
})

$("#otherFees").keyup(()=>{
  let total=Number($("#collegeFees").val())+Number($("#skillFees").val())+Number($("#busOrVanFees").val())+Number($("#otherFees").val())+Number($("#fine").val());
$("#total").html(total)
})

$("#fine").keyup(()=>{
  let total=Number($("#collegeFees").val())+Number($("#skillFees").val())+Number($("#busOrVanFees").val())+Number($("#otherFees").val())+Number($("#fine").val());
$("#total").html(total)
})
//end cal total
 })</script>
  </body>
  
 </html>
